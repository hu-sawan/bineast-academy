{"version":3,"file":"static/js/276.1e9e2f1d.chunk.js","mappings":"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","sources":["components/error/ErrorCard.tsx","components/video/Video.tsx"],"sourcesContent":["import \"./ErrorCard.scss\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faXmark } from \"@fortawesome/free-solid-svg-icons\";\r\n\r\ninterface ErrorCardProps {\r\n    message: string;\r\n    fill?: boolean;\r\n    onTop?: boolean;\r\n    position?: \"relative\" | \"absolute\";\r\n}\r\n\r\nfunction ErrorCard({\r\n    message,\r\n    position = \"absolute\",\r\n    fill = false,\r\n    onTop = false,\r\n}: ErrorCardProps) {\r\n    return (\r\n        <div className={`error-card ${fill && \"fill\"} ${onTop && \"on-top\"}`}>\r\n            <div className=\"error-card__wrapper\">\r\n                <div className=\"icon\">\r\n                    <FontAwesomeIcon icon={faXmark} />\r\n                </div>\r\n                {message}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ErrorCard;\r\n","import \"./Video.scss\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faCircleCheck } from \"@fortawesome/free-solid-svg-icons\";\r\nimport Loading from \"../loading/Loading\";\r\nimport ErrorCard from \"../error/ErrorCard\";\r\nimport {\r\n    CourseContextInterface,\r\n    Instructor,\r\n    VideoDetails,\r\n} from \"../../types/types\";\r\nimport { useCourse } from \"../../contexts/CourseContext\";\r\nimport { useAuth } from \"../../contexts/AuthContext\";\r\nimport { useAccessToken } from \"../../contexts/AccessTokenContext\";\r\n\r\nfunction Video() {\r\n    const { courseId, videoId } = useParams();\r\n\r\n    const {\r\n        course,\r\n        videos,\r\n        instructors,\r\n        activeVideoIdx,\r\n        setActiveVideoIdx,\r\n        setVideos,\r\n        setCourse,\r\n    } = useCourse();\r\n\r\n    const [video, setVideo] = useState<VideoDetails | null>(null);\r\n    const [isNextDisabled, setIsNextDisabled] = useState<boolean>(\r\n        activeVideoIdx === videos.length - 1 ? true : false\r\n    );\r\n    const [isPrevDisabled, setIsPrevDisabled] = useState<boolean>(\r\n        activeVideoIdx === 0 ? true : false\r\n    );\r\n\r\n    const [done, setDone] = useState<boolean>(video?.isDone ?? false);\r\n    const [loading, setLoading] = useState<boolean>(false);\r\n    const [error, setError] = useState<string>(\"\");\r\n\r\n    const navigate = useNavigate();\r\n\r\n    const { user } = useAuth();\r\n\r\n    const accessToken = useAccessToken();\r\n\r\n    useEffect(() => {\r\n        const getVideo = async () => {\r\n            try {\r\n                setError(\"\");\r\n                setVideo(null);\r\n                const response = await fetch(\r\n                    process.env.REACT_APP_API_URL +\r\n                        `/api/videos/details/${courseId}/${videoId}/${user?.uid}`,\r\n                    {\r\n                        method: \"GET\",\r\n                        headers: {\r\n                            \"content-type\": \"application/json\",\r\n                            \"x-access-token\": accessToken,\r\n                        },\r\n                    }\r\n                );\r\n\r\n                const data = await response.json();\r\n\r\n                if (response.status !== 200) throw Error(data.message);\r\n\r\n                setVideo(data[0]);\r\n            } catch (error) {\r\n                if (error instanceof Error) {\r\n                    setError(error.message);\r\n                } else {\r\n                    setError(\"Error fetching data from server\");\r\n                }\r\n            }\r\n        };\r\n\r\n        getVideo();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [courseId, videoId, user]);\r\n\r\n    // A simple useEffect to decide if the prev, next buttons are disabled\r\n    useEffect(() => {\r\n        if (activeVideoIdx === 0) {\r\n            setIsPrevDisabled(true);\r\n        } else {\r\n            setIsPrevDisabled(false);\r\n        }\r\n\r\n        if (activeVideoIdx === videos.length - 1) {\r\n            setIsNextDisabled(true);\r\n        } else {\r\n            setIsNextDisabled(false);\r\n        }\r\n    }, [activeVideoIdx, videos.length]);\r\n\r\n    // This useEffect synchronizes the data retrieved from the backend with the component's state.\r\n    useEffect(() => {\r\n        setDone(video?.isDone ?? false);\r\n    }, [video]);\r\n\r\n    const handleDoneClick = async () => {\r\n        // this is just to avoid react anger :)\r\n        if (!course) return;\r\n\r\n        /**\r\n         * The first implementation I came with was to define a new function in the course context\r\n         * that requests a new copy of the videos and course, this was inefficient and not necessary.\r\n         *\r\n         * The second implementation which is the current one is to update the course and videos\r\n         * state locally in the client side without requesting a new copy from the server while keeping\r\n         * the server in sync with the client side. this reduced the number of requests to the server\r\n         * and made the app more efficient. And each time the user refreshes the page, the data will be\r\n         * fetched from the server.\r\n         */\r\n\r\n        let updatedCourse: CourseContextInterface;\r\n        setLoading(true);\r\n        // if already done then delete the done status\r\n        if (done) {\r\n            const response = await fetch(\r\n                `http://localhost:5050/api/videos/finished`,\r\n                {\r\n                    method: \"DELETE\",\r\n                    headers: {\r\n                        \"Content-Type\": \"application/json\",\r\n                        \"x-access-token\": accessToken,\r\n                    },\r\n                    body: JSON.stringify({\r\n                        courseId,\r\n                        videoId,\r\n                        userId: user?.uid ?? null,\r\n                    }),\r\n                }\r\n            );\r\n\r\n            const data = await response.json();\r\n\r\n            if (response.status !== 200) {\r\n                setError(data.message);\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            updatedCourse = {\r\n                ...course,\r\n                completed: (course?.completed ?? 1) - 1,\r\n            };\r\n\r\n            setDone(false);\r\n        }\r\n        // if not done then set the done status\r\n        else {\r\n            const response = await fetch(\r\n                `http://localhost:5050/api/videos/finished`,\r\n                {\r\n                    method: \"POST\",\r\n                    headers: {\r\n                        \"Content-Type\": \"application/json\",\r\n                        \"x-access-token\": accessToken,\r\n                    },\r\n                    body: JSON.stringify({\r\n                        courseId,\r\n                        videoId,\r\n                        userId: user?.uid ?? null,\r\n                    }),\r\n                }\r\n            );\r\n\r\n            const data = await response.json();\r\n\r\n            if (response.status !== 200) {\r\n                setError(data.message);\r\n                setLoading(false);\r\n                return;\r\n            }\r\n            updatedCourse = {\r\n                ...course,\r\n                completed: (course?.completed ?? -1) + 1,\r\n            };\r\n\r\n            setDone(true);\r\n        }\r\n\r\n        const updatedVideos = videos.map((video) => {\r\n            if (video.courseId === courseId && video.id === videoId) {\r\n                return { ...video, isDone: !video.isDone };\r\n            }\r\n\r\n            return video;\r\n        });\r\n\r\n        setCourse(updatedCourse);\r\n        setVideos(updatedVideos);\r\n\r\n        setLoading(false);\r\n    };\r\n\r\n    const handlePrevClick = () => {\r\n        // set true to avoid race condition\r\n        setActiveVideoIdx(activeVideoIdx - 1);\r\n        navigate(`/course/${courseId}/${videos[activeVideoIdx - 1].id}`);\r\n    };\r\n\r\n    const handleNextClick = () => {\r\n        // set true to avoid race condition\r\n        setIsNextDisabled(true);\r\n\r\n        setActiveVideoIdx(activeVideoIdx + 1);\r\n        navigate(`/course/${courseId}/${videos[activeVideoIdx + 1].id}`);\r\n    };\r\n\r\n    if (error)\r\n        return (\r\n            <div className=\"video\">\r\n                <ErrorCard message={error} />\r\n            </div>\r\n        );\r\n\r\n    return (\r\n        <div className={`video ${video?.isDone ? \"done\" : null}`}>\r\n            {!video ? (\r\n                <Loading />\r\n            ) : (\r\n                <>\r\n                    <div className=\"video__heading\">\r\n                        <h2>{video.title}</h2>\r\n                        {!!done && (\r\n                            <FontAwesomeIcon\r\n                                className=\"video__heading__check\"\r\n                                icon={faCircleCheck}\r\n                            ></FontAwesomeIcon>\r\n                        )}\r\n                    </div>\r\n                    <video controls>\r\n                        {/* <source src={video.videoUrl} type=\"video/mp4\" /> */}\r\n                    </video>\r\n                    <div className=\"video__instructor\">\r\n                        Instructor(s):{\" \"}\r\n                        {instructors.map(({ fullName }: Instructor, idx) => {\r\n                            return (\r\n                                (fullName === null ? \"unknown\" : fullName) +\r\n                                (idx === instructors.length - 1 ? \"\" : \", \")\r\n                            );\r\n                        })}\r\n                    </div>\r\n                    <div className=\"video__description\">\r\n                        {video.description}\r\n                    </div>\r\n                    <div className=\"video__nav\">\r\n                        {user && (\r\n                            <button\r\n                                className={`done-btn ${done ? \"done\" : null}`}\r\n                                onClick={handleDoneClick}\r\n                                disabled={loading}\r\n                            >\r\n                                Done\r\n                            </button>\r\n                        )}\r\n                        <button\r\n                            className=\"prev-btn\"\r\n                            onClick={handlePrevClick}\r\n                            disabled={isPrevDisabled}\r\n                        >\r\n                            Prev\r\n                        </button>\r\n                        <button\r\n                            className=\"next-btn\"\r\n                            onClick={handleNextClick}\r\n                            disabled={isNextDisabled}\r\n                        >\r\n                            Next\r\n                        </button>\r\n                    </div>\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Video;\r\n"],"names":["_ref","message","position","fill","onTop","_jsx","className","concat","children","_jsxs","FontAwesomeIcon","icon","faXmark","_video$isDone","courseId","videoId","useParams","course","videos","instructors","activeVideoIdx","setActiveVideoIdx","setVideos","setCourse","useCourse","video","setVideo","useState","isNextDisabled","setIsNextDisabled","length","isPrevDisabled","setIsPrevDisabled","done","setDone","isDone","loading","setLoading","error","setError","navigate","useNavigate","user","useAuth","accessToken","useAccessToken","useEffect","async","response","fetch","process","uid","method","headers","data","json","status","Error","getVideo","_video$isDone2","ErrorCard","_Fragment","title","faCircleCheck","controls","map","idx","fullName","description","onClick","updatedCourse","_user$uid","_course$completed","body","JSON","stringify","userId","completed","_user$uid2","_course$completed2","updatedVideos","id","disabled","handlePrevClick","handleNextClick","Loading"],"sourceRoot":""}